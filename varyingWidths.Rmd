---
title: "Barplot with varying widths"
author: "Prince Charming"
date: "February 1, 2017"
output: html_document
---

In this post, I am going to show how to use R to create bar charts with varying widths and remove spaces between bars. This can be done using both, ggplot2 and base graphics. While reading the post, you can learn a few things:

1) create basic bar charts with ggplot2
2) add colors to ggplot based on value of a variable
3) remove spaces between bars in ggplot2
4) basic customization of axes in ggplot2
5) all of the above using base graphics

## Setup
Let's have a dataset with one categorical and two quantitative variables. We want to create a bar chart showing values of one of the numerical variables, while using the other numerical variable to produce bars of different widths. Our categorical variable can be groups of people, and the 2 numericals can be some score and quantity of the people.

```{r}
# create a dataframe with 3 groups of people,
# some score and count of the people
data <- data.frame(group = c("Heroes", "Villains", "Humans"),
                   score = c(4,2,3),
                   count = c(10,20,40))

# show the dataset
data

# create a basic barplot
barplot(data[, 2],names.arg =  data[,1],
        main = "Basic Barplot")

```

This bar plot looks ok, but we are not visualizing the count variable yet. To do so, we can change the widths of the bars to represent share on total population. R allows us to do this with both of the most frequent approaches to creating plots: ggplot2 and basic graphics.

## ggplot2

Let's start by creating a basic bar chart with ggplot2.

```{r}
# load the ggplot2 package
library(ggplot2)

# create a basic bar chart
ggplot(data, aes(x = group, y = score)) +
        geom_bar(stat="identity") +
        # add a title
        ggtitle("Basic barplot with ggplot2")

```

Now, we want to add varying widths of the bars in the bar chart. In ggplot2 we can do this using the width parameter of aes(). Let's also use the fill parameter to create bars with different colors.

```{r}

ggplot(data, aes(x = group,
                 y = score,
                 width = count/sum(count),
                 fill = count)) +
        geom_bar(stat = "identity") +
        ggtitle("ggplot2 bar plot with varying widths")

```

Alright, that is better. What if we do not like the spaces between individual bars?

That is where the actual challenge starts, because with discrete horizontal axis, you are stuck between equidistant tick marks.

You have to make the horizontal axis continuous and calculate the location of tick marks. Location of tick marks can be specified by cumulative sum of the widths. Moreover, you want to have tick marks in the center of the bars, so you have to always subtract half of the width of the bar.

```{r}
# calculate width of bars
data$width <- data$count/sum(data$count)

# calculate location of the tick marks
data$location <- cumsum(data$width) - data$width/2

# create a bar plot
# first plot the calculated locations on the x axis
# score still as height of the bars
# color based on count variable
ggplot(data, aes(x = location,
                 y = score, 
                 fill = count, 
                 width = width)) +
        geom_bar(stat = "identity") +
        # make the x axis continuous with desired tick marks and labels
        scale_x_continuous(breaks = data$location, labels = data$group) +
        # add a chart title
        ggtitle("Ggplot2 bar plot with adjecent bars of varying width")

```

And just like that, space between variables in bar plot doesn't have to be constant.

## Base graphics

Now we know how to create uneven distances between x axis breaks, or tick marks, using ggplot2. But what if we don't want to use ggplot2? Can we obtain the same plot using just the R Programming Language base graphics?

Yes, we can!

Let's start with a basic bar plot again.

```{r}
# create a bar plot
barplot(data$score, names.arg = data$group)
# change a title
title("Basic graphics bar plot")

```

How do we add varying widths? Use the width parameter of barplot and as values use what we already calculated in the ggplot2 section.

```{r}
barplot(data$score, width = data$width, names.arg = data$group)
title("Basic graphics variable width bar plot")

```

How to remove spaces between bars? Just set barplot space parameter to 0. We should also try to use some colors for the bars.

```{r}
barplot(data$score,
        # use variable width
        width = data$width, 
        # remove spaces between bars
        space = 0, 
        # plot names of categorical variables
        names.arg = data$group,
        # add colors
        col = colors()[data$count])
title("Basic graphics bar plot with varying widths and no spaces")
```

As usual with R, there are multiple ways of solving a problem. Whether to use these kind of charts is another question. The consensus in the academic community would probably say that the widths of the bar charts do not add any real value. On the other hand, in corporate setting, they might come in handy. It is all about personal preferences.
